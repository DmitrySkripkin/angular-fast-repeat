angular.module("gc.fastRepeat",[]).directive("fastRepeat",["$compile","$parse","$animate","$rootScope",function(a,b,c){"use strict";function d(a,b){return a.slice&&"$$"==a.slice(0,2)?void 0:b}function e(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}var f=0,g=!1;return{restrict:"A",transclude:"element",priority:1e3,compile:function(){return function(a,h,i,j,k){var l,m=i.fastRepeat.split(" in "),n=m[1],o=m[0],p=b(n),q={},r=a.$new();r[o]=p(r)[0]||{},r.fastRepeatStatic=!0,r.fastRepeatDynamic=!1;var s=k(r,function(a){c.enabled(!1,a)}),t=$("<div/>");$("body").append(t),r.$on("$destroy",function(){t.detach()}),t.css({position:"absolute",top:"110%"});var u=h.parents().filter(function(){return"inline"!==$(this).css("display")}).first();t.width(u.width()),t.height(u.height()),t.append(s);var v=function(a,b,c){function d(c){return b[o]=c,b.$digest(),a.attr("fast-repeat-id",c.$$fastRepeatId),a.clone()}var e=p(b),g={};angular.forEach(e,function(a){a.$$fastRepeatId||(a.$$fastRepeatId=a.id?a.id:a._id?a._id:++f),g[a.$$fastRepeatId]=a}),angular.forEach(q,function(a,b){g[b]||a.el.detach()});var i=h;angular.forEach(e,function(a){var b=a.$$fastRepeatId,e=q[b];if(e){if(!e.compiled&&(c||!angular.equals(e.copy,a))){var f=d(a);e.el.replaceWith(f),e.el=f,e.copy=angular.copy(a)}}else e={copy:angular.copy(a),item:a,el:d(a)},q[b]=e;i.after(e.el.last()),i=e.el.last()})},w=!1;a.$watch(function(a){return JSON.stringify(p(a),d)},function(b){t.width(u.width()),t.height(u.height()),w||(w=!0,g&&(l=e()),a.$$postDigest(function(){t.width(u.width()),t.height(u.height()),r.$digest(),v(s,r),g&&(l=e()-l,console.log("Total time: ",l,"ms"),console.log("time per row: ",l/b.length)),w=!1}))},!1),h.parent().on("click","[fast-repeat-id]",function(a){var b=$(this),c=b.attr("fast-repeat-id"),d=r.$new(!1),e=b.find("*").index(a.target);d[o]=q[c].item,d.fastRepeatStatic=!1,d.fastRepeatDynamic=!0;var f;f=k(d,function(a){t.append(a)}),d.$$postDigest(function(){b.replaceWith(f),q[c]={compiled:!0,el:f},e>=0?f.find("*").eq(e).trigger("click"):f.trigger("click")}),d.$digest()});var x=function(){t.width(u.width()),t.height(u.height())},y=$(window);y.on("resize",x),h.on("$destroy",function(){y.off("resize",x)})}}}}]);