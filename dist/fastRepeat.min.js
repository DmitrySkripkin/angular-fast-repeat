angular.module("gc.fastRepeat",[]).directive("fastRepeat",["$compile","$parse",function(a,b){"use strict";function c(a,b){return a.slice&&"$$"==a.slice(0,2)?void 0:b}function d(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}var e=0,f=!1;return{restrict:"A",scope:!1,transclude:"element",priority:1e4,compile:function(){return function(a,g,h,i,j){var k,l=h.fastRepeat.split(" in "),m=l[1],n=l[0],o=b(m),p={},q=a.$new(!1);q[n]=o(a)[0]||{},j(q,function(b,h){function i(a){return h[n]=a,h.$digest(),b.attr("fast-repeat-id",a.$$fastRepeatId),b.clone()}a.$watch(function(a){return JSON.stringify(o(a),c)},function(b){b=o(a),f&&(k=d()),a.$$postDigest(function(){var a={};angular.forEach(b,function(b){b.$$fastRepeatId||(b.$$fastRepeatId=++e),a[b.$$fastRepeatId]=b}),angular.forEach(p,function(b,c){a[c]||b.el.detach()});var c=g;angular.forEach(b,function(a){var b=a.$$fastRepeatId,d=p[b];if(d){if(!d.compiled&&!angular.equals(d.copy,a)){var e=i(a);d.el.replaceWith(e),d.el=e,d.copy=angular.copy(a)}}else d={copy:angular.copy(a),item:a,el:i(a)},p[b]=d;c.after(d.el.last()),c=d.el.last()}),f&&(k=d()-k,console.log("Total time: ",k,"ms"),console.log("time per row: ",k/b.length))})},!1)}),g.parent().on("click","[fast-repeat-id]",function(b){var c=$(this),d=c.attr("fast-repeat-id"),e=a.$new(!1),f=c.find("*").index(b.target);e[n]=p[d].item;j(e,function(a,b){b.$$postDigest(function(){c.replaceWith(a),p[d]={compiled:!0,el:a},f>=0?a.find("*").eq(f).trigger("click"):a.trigger("click")})});e.$digest()})}}}}]);