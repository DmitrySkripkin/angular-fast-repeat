angular.module("gc.fastRepeat",[]).directive("fastRepeat",["$compile","$parse","$animate","$rootScope",function(a,b,c){"use strict";function d(a,b){return a.slice&&"$$"==a.slice(0,2)?void 0:b}function e(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}function f(a,b){for(var c=a.find("*"),d=b.find("*"),e=0;e<c.length;e++)$(c[e]).attr("class",$(d[e]).attr("class"));a.attr("class",b.attr("class"))}var g=0,h=!1;return{restrict:"A",transclude:"element",priority:1e3,compile:function(){return function(a,i,j,k,l){var m,n=j.fastRepeat.split(" in "),o=n[1],p=n[0],q=b(o),r={},s=a.$new();s[p]=q(s)[0]||{};var t=l(s,function(a){c.enabled(!1,a)}),u=$("<div/>");$("body").append(u),s.$on("$destroy",function(){u.detach()}),u.css({position:"absolute",top:"-10000px",left:"-1000px"});var v=i.parents().filter(function(){return"inline"!==$(this).css("display")}).first();u.width(v.width()),u.height(v.height()),u.append(t);var w=function(a,b){function c(c){return b[p]=c,b.$digest(),a.attr("fast-repeat-id",c.$$fastRepeatId),a.clone()}var d=q(b),e={};angular.forEach(d,function(a){a.$$fastRepeatId||(a.$$fastRepeatId=a.id?a.id:a._id?a._id:++g),e[a.$$fastRepeatId]=a}),angular.forEach(r,function(a,b){e[b]||a.el.detach()});var h=i;angular.forEach(d,function(a){var b=a.$$fastRepeatId,d=r[b];if(d){if(!d.compiled&&!angular.equals(d.copy,a)){var e=c(a);f(e,d.el),d.el.replaceWith(e),d.el=e,d.copy=angular.copy(a)}}else d={copy:angular.copy(a),item:a,el:c(a)},r[b]=d;h.after(d.el.last()),h=d.el.last()})},x=!1;a.$watch(function(a){return JSON.stringify(q(a),d)},function(b){u.width(v.width()),u.height(v.height()),x||(x=!0,h&&(m=e()),a.$$postDigest(function(){u.width(v.width()),u.height(v.height()),s.$digest(),w(t,s),h&&(m=e()-m,console.log("Total time: ",m,"ms"),console.log("time per row: ",m/b.length)),x=!1},0))},!1),i.parent().on("click","[fast-repeat-id]",function(a){var b=$(this),c=b.attr("fast-repeat-id"),d=s.$new(!1),e=b.find("*").index(a.target);d[p]=r[c].item;var f;f=l(d,function(a){u.append(a)}),d.$$postDigest(function(){b.replaceWith(f),r[c]={compiled:!0,el:f},e>=0?f.find("*").eq(e).trigger("click"):f.trigger("click")}),d.$digest()})}}}}]);