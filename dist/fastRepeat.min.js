angular.module("gc.fastRepeat",[]).directive("fastRepeat",["$compile","$parse","$animate","$rootScope",function(a,b,c,d){"use strict";function e(a,b){return a.slice&&"$$"==a.slice(0,2)?void 0:b}function f(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}var g=0,h=!1;return{restrict:"A",transclude:"element",priority:1e3,compile:function(a,d){return function(a,d,i,j,k){function l(){a.$$postDigest(function(){u.width(v.width()),u.height(v.height()),s.$digest(),w(t,s,!0)})}var m,n=i.fastRepeat.split(" in "),o=n[1],p=n[0],q=b(o),r={},s=a.$new();s[p]=q(s)[0]||{},s.fastRepeatStatic=!0,s.fastRepeatDynamic=!1;var t=k(s,function(a,b){c.enabled(!1,a)}),u=$("<div/>");$("body").append(u),s.$on("$destroy",function(){u.detach()}),u.css({position:"absolute",top:"110%"});var v=d.parents().filter(function(){return"inline"!==$(this).css("display")}).first();u.width(v.width()),u.height(v.height()),u.append(t);var w=function(a,b,c){function e(c){return b[p]=c,b.$digest(),a.attr("fast-repeat-id",c.$$fastRepeatId),a.clone()}var f=q(b),h={};angular.forEach(f,function(a){a.$$fastRepeatId||(a.id?a.$$fastRepeatId=a.id:a._id?a.$$fastRepeatId=a._id:a.$$fastRepeatId=++g),h[a.$$fastRepeatId]=a}),angular.forEach(r,function(a,b){h[b]||a.el.detach()});var i=d;angular.forEach(f,function(a){var b=a.$$fastRepeatId,d=r[b];if(d){if(!d.compiled&&(c||!angular.equals(d.copy,a))){var f=e(a);d.el.replaceWith(f),d.el=f,d.copy=angular.copy(a)}}else d={copy:angular.copy(a),item:a,el:e(a)},r[b]=d;i.after(d.el.last()),i=d.el.last()})},x=!1;a.$watch(function(a){return JSON.stringify(q(a),e)},function(b){u.width(v.width()),u.height(v.height()),x||(x=!0,h&&(m=f()),a.$$postDigest(function(){u.width(v.width()),u.height(v.height()),s.$digest(),w(t,s),h&&(m=f()-m,console.log("Total time: ",m,"ms"),console.log("time per row: ",m/b.length)),x=!1}))},!1),i.fastRepeatWatch&&a.$watch(i.fastRepeatWatch,l),a.$on("fastRepeatForceRedraw",l),d.parent().on("click","[fast-repeat-id]",function(a){var b=$(this);if(!b.parents().filter("[fast-repeat-id]").length){a.stopPropagation();var c=b.attr("fast-repeat-id"),d=s.$new(!1),e=b.find("*").index(a.target);d[p]=r[c].item,d.fastRepeatStatic=!1,d.fastRepeatDynamic=!0;var f;f=k(d,function(a,b){u.append(a)}),d.$$postDigest(function(){b.replaceWith(f),r[c]={compiled:!0,el:f},setTimeout(function(){e>=0?f.find("*").eq(e).trigger("click"):f.trigger("click")},0)}),d.$digest()}});var y=function(){u.width(v.width()),u.height(v.height())},z=$(window);z.on("resize",y),d.on("$destroy",function(){z.off("resize",y)})}}}}]);