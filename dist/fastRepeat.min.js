angular.module("gc.fastRepeat",[]).directive("fastRepeat",["$compile","$parse","$animate","$rootScope",function(a,b,c){"use strict";function d(a,b){return a.slice&&"$$"==a.slice(0,2)?void 0:b}function e(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}var f=0,g=!1,h=function(a,b,c){var d,e,f,g,h,i=Date.now||function(){return(new Date).getTime()},j=function(){var k=i()-g;b>k&&k>0?d=setTimeout(j,b-k):(d=null,c||(h=a.apply(f,e),d||(f=e=null)))};return function(){f=this,e=arguments,g=i();var k=c&&!d;return d||(d=setTimeout(j,b)),k&&(h=a.apply(f,e),f=e=null),h}};return{restrict:"A",transclude:"element",priority:1e3,compile:function(){return function(a,i,j,k,l){var m,n=j.fastRepeat.split(" in "),o=n[1],p=n[0],q=b(o),r={},s=a.$new();s[p]=q(s)[0]||{},s.fastRepeatStatic=!0,s.fastRepeatDynamic=!1;var t=l(s,function(a){c.enabled(!1,a)}),u=$("<div/>");$("body").append(u),s.$on("$destroy",function(){u.detach()}),u.css({position:"absolute",top:"110%"});var v=i.parents().filter(function(){return"inline"!==$(this).css("display")}).first();u.width(v.width()),u.height(v.height()),u.append(t);var w=function(a,b,c){function d(c){return b[p]=c,b.$digest(),a.attr("fast-repeat-id",c.$$fastRepeatId),a.clone()}var e=q(b),g={};angular.forEach(e,function(a){a.$$fastRepeatId||(a.$$fastRepeatId=a.id?a.id:a._id?a._id:++f),g[a.$$fastRepeatId]=a}),angular.forEach(r,function(a,b){g[b]||a.el.detach()});var h=i;angular.forEach(e,function(a){var b=a.$$fastRepeatId,e=r[b];if(e){if(!e.compiled&&(c||!angular.equals(e.copy,a))){var f=rowEl;e.el.replaceWith(f),e.el=f,e.copy=angular.copy(a)}}else e={copy:angular.copy(a),item:a,el:d(a)},r[b]=e;h.after(e.el.last()),h=e.el.last()})},x=!1;a.$watch(function(a){return JSON.stringify(q(a),d)},function(b){u.width(v.width()),u.height(v.height()),x||(x=!0,g&&(m=e()),a.$$postDigest(function(){u.width(v.width()),u.height(v.height()),s.$digest(),w(t,s),g&&(m=e()-m,console.log("Total time: ",m,"ms"),console.log("time per row: ",m/b.length)),x=!1}))},!1),i.parent().on("click","[fast-repeat-id]",function(a){var b=$(this),c=b.attr("fast-repeat-id"),d=s.$new(!1),e=b.find("*").index(a.target);d[p]=r[c].item,d.fastRepeatStatic=!1,d.fastRepeatDynamic=!0;var f;f=l(d,function(a){u.append(a)}),d.$$postDigest(function(){b.replaceWith(f),r[c]={compiled:!0,el:f},e>=0?f.find("*").eq(e).trigger("click"):f.trigger("click")}),d.$digest()});var y=h(function(){u.width(v.width()),u.height(v.height()),s.$digest(),x||w(t,s,!0)},500),z=$(window);z.on("resize",y),i.on("$destroy",function(){z.off("resize",y)})}}}}]);